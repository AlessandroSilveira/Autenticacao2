<h2>Cadastrar Nova Senha</h2>
<h4>Informe a sua nova senha</h4>

<table>
	<tr>
		<td>
			Senha:
		</td>
		<td>
			@Html.Password("Senha")
			<br />

		</td>
	</tr>
	<tr>
		<td>
			Confirmar Senha:
		</td>
		<td>
			@Html.Password("Confirmar_Senha")
			<br />
			<input type="hidden" id="token" value="@ViewBag.Token" />
			<input type="hidden" id="id" value="@ViewBag.id" />
		</td>
	</tr>
	<tr>
		<td colspan="2"><input type="submit" id="request-button" value="Enviar" /></td>
	</tr>
	<div id="result-area"></div>
</table>
<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
<script>


	$(document).ready(function () {
		var data = {
			grant_type: 'password'
		}

		$.ajax({
			url: "http://localhost:53151/api/security/token",
			type: 'post',
			contentType: 'x-www-form-urlencoded',
			data: data
		})
			.done(function (data) {
				$("#request-button").on('click', function () {
					$("#result-area").html("");
					var senha1 = $("#Senha").val();
					var confirmaSenha = $("#Confirmar_Senha").val();
					if (senha1 !== confirmaSenha) {
						$("#result-area").append("<p style='color:red'>Senhas não conferem</p>");
						return false;
					}

					$("#result-area").html("");
					var token = $("#token").val();
					var senha = $("#Senha").val();
					var id = $("#id").val();

					$.ajax({
						url: "http://localhost:53151/api/newpassword?token=" + token + "&id=" + id + "&senha=" + senha + "",
						type: 'post',
						contentType: 'application/json',
						headers: {
							"Authorization": "Bearer " + token
						}
					})
						.done(function (data) {
							$("#result-area").append("<p style='color:red'>" + data + "</p>");
						})
						.error(function (error) {
							$("#result-area").append("<p style='color:red'>Falha na requisição</p>");
						});
					return false;
				});
			})
			.error(function (data) {
				$("#result-area").append("<p style='color:red'>Usuário ou senha inválidos</p>");
			});
	});
</script>

