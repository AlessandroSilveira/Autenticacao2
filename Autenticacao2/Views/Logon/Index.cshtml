
<h2>Login</h2>
<h4>Informe seu E-mail e Senha</h4>

<table>
	<tr>
		<td>
			E-mail:
		</td>
		<td>
			@Html.TextBox("Email")
			<br />

		</td>
	</tr>
	<tr>
		<td>
			Senha:
		</td>
		<td>
			@Html.Password("Senha")
			<br />

		</td>
	</tr>
	<tr>
		<td colspan="2"><input type="submit" id="request-button" value="Enviar" /></td>
	</tr>
	<div id="result-area"></div>
</table>
<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
<script>


	$(document).ready(function () {
		var data = {
			grant_type: 'password'
		}

		$.ajax({
			url: "http://localhost:53151/api/security/token",
			type: 'post',
			contentType: 'x-www-form-urlencoded',
			data: data
		})
			.done(function (data) {
				$("#request-button").on('click',
					function () {
						$("#result-area").html("");
						var email = $("#Email").val();
						var senha = $("#Senha").val();
						var token = data.access_token;

						if (email === "") {
							$("#result-area").append("<p style='color:red'>Informe o email</p>");
							return false;
						}
						if (senha === "") {
							$("#result-area").append("<p style='color:red'>Informe a senha</p>");
							return false;
						}

						$("#result-area").html("");
						$.ajax({
							url: "http://localhost:53151/api/login?Email=" + email + "&Senha=" + senha + "&token=" + token + "",
							type: 'post',
							contentType: 'application/json',
							headers: {
								"Authorization": "Bearer " + token
							}

						})
							.done(function (result) {

								window.location.href = "http://localhost:53151/Perfil/Index?id=" + result.usuarioId;
							});

					});
			});

	});
</script>

